# 進捗記録
## 2026-02-26

1. 設定削除の過去影響問題 — `effective_to` による有効期間管理 (v1.25.0)

   **課題**

   - `submission_rules`（休息日・グループ・提出期限）や `submission_items` をUIから削除すると物理削除され、過去のストリーク/ストレート計算が壊れる
   - 例: 土曜を休息日に設定後に削除すると、過去の土曜も「投稿すべき日」に変わりストリークが途切れる

   **変更**

   - `submission_rules` と `submission_items` に `effective_to` カラムを追加（`[effective_from, effective_to)` 半開区間セマンティクス）
   - 全削除ハンドラを物理削除から論理削除に変更（`effective_to = max(today, effective_from)` で設定）
   - `useSubmissionRules.ts`: 全判定関数（`getRuleForDate`, `isRestDayForDate`, `getTargetDaysPerWeek`）に `effective_to` フィルタ追加。`getGroupConfigsForDate(date)` と `getAllActiveGroupConfigs()` を新設
   - `useSubmissionItems.ts`, `SwipeableWorkoutView.tsx`: `effective_to` フィルタ追加
   - `useGamification.ts`, `CalendarPage.tsx`, `groupFulfillment.ts`: `getGroupConfigsForDate` 経由に切り替え
   - `streakCalculator.ts`: `GroupConfig` 型に `effectiveTo` 追加、`calculatePerfectWeeks` で日単位の有効期間チェック
   - `SubmissionSettingsPage.tsx`: 各設定セクションに「削除済み」アコーディオン追加（折りたたみ式テーブル、`effective_to` 編集可能）

   **変更ファイル**
   - `supabase/migrations/add_effective_to.sql`（新規）
   - `supabase/schema.sql`
   - `src/types/database.types.ts`
   - `src/hooks/useSubmissionRules.ts`
   - `src/hooks/useSubmissionItems.ts`
   - `src/hooks/useGamification.ts`
   - `src/components/calendar/SwipeableWorkoutView.tsx`
   - `src/pages/calendar/CalendarPage.tsx`
   - `src/pages/admin/SubmissionSettingsPage.tsx`
   - `src/utils/streakCalculator.ts`
   - `src/utils/groupFulfillment.ts`

2. ストレートTooltip目標日数表示・グループ必要日数入力バグ修正 (v1.24.2)

   **課題**

   - ストレート達成のTooltipが「目標日数」とだけ表示し、管理者が設定した具体的な日数が分からない
   - グループ設定の「そのうちx日でよい」数値入力で、Backspaceで値が0になり消せない・デスクトップのスピナーが動作しない・モバイルにスピナーがない

   **変更**

   - `CalendarPage.tsx`: ストレートTooltipのIIFE内で `use_target_days` に基づき目標日数を算出し「目標日数（N日）」として表示
   - `number-stepper.tsx`: [-][+]ボタン付きの再利用可能なNumberStepperコンポーネントを新規作成。値をテキスト表示にしキーボード入力問題を根本排除
   - `SubmissionSettingsPage.tsx`: `<Input type="number">` を `<NumberStepper>` に置換
   - `database.types.ts`: `@supabase/postgrest-js` v2.89.0 が要求する `Relationships` フィールドを全テーブルに追加。`submissions` テーブルには `profiles` への外部キーリレーションを定義。Vercel `tsc -b` ビルドエラーを修正
   - `AuthContext.tsx`: `from('profiles' as any)` を `from('profiles')` に変更（`as any` が新しいリレーション型推論と干渉していた）

   **変更ファイル**
   - `src/pages/calendar/CalendarPage.tsx`
   - `src/components/ui/number-stepper.tsx`（新規）
   - `src/pages/admin/SubmissionSettingsPage.tsx`
   - `src/types/database.types.ts`
   - `src/context/AuthContext.tsx`

2. シールド適用バグ修正・UI改善・ストリーク計算修正 (v1.24.1)

   **課題**

   - `effective_from` 設定ユーザーがシールドを適用すると、RPC は 200 OK を返すが `data = false` で何も起きない（DB の `shield_stock` が 0 のまま同期されていない）
   - シールド適用失敗時に UI フィードバックがない
   - カレンダーセルのシールドアイコンが左上に小さく表示され、適用したことが分かりづらい
   - 「シールドを取り消す」ボタンが別行に表示されスペースを無駄に使う
   - シールド適用日が連続日数（ストリーク）にカウントされていた（本来はリセットしないだけでカウント不要）

   **変更**

   - `useGamification.ts`: `syncGamificationProfile` ヘルパーを追加し、RPC 呼び出し前にフロントエンド計算値（`shield_stock` / `perfect_week_count`）を DB に同期。`isReady` フラグでデータロード完了をガード。RPC 成功後に `onRefreshSubmissions` で submissions も再取得
   - `CalendarPage.tsx`: `useGamification` に `dataLoading` / `onRefreshSubmissions` を渡す。`_rulesLoading` を `rulesLoading` にリネームして実使用。シールド日のカレンダーセル表示をスタンプと同サイズの中央オーバーレイに変更
   - `SwipeableWorkoutView.tsx`: シールドボタンを非同期化し失敗時に destructive トースト表示。「取り消す」ボタンを「シールド適用中」カードの右上に統合
   - `streakCalculator.ts`: シールド日の処理を `consecutiveDays++` から `continue`（スキップ）に変更。ストリークを途切れさせないがカウントは増やさない

   **変更ファイル**
   - `src/hooks/useGamification.ts`
   - `src/pages/calendar/CalendarPage.tsx`
   - `src/components/calendar/SwipeableWorkoutView.tsx`
   - `src/utils/streakCalculator.ts`

2. Phase D: ゲーミフィケーション刷新 — シールド手動適用・ストレート週単位判定・バグ修正 (v1.24.0)

   **課題**

   - シールドが自動消費のみでユーザーの意図に合わない運用だった
   - ストレート（パーフェクトウィーク）判定がストリーク計算に依存しており、ストリークが切れると累積カウントが正しくなかった
   - `confirmedBeforeDate` が `today - past_submission_days` で計算されていたため、`effective_from` 設定後しばらく全週がスキップされるバグがあった
   - `effective_from` 設定時にシールド残数が無条件で0になり、ストレート達成によるシールド獲得が反映されなかった

   **変更**

   - DB: `submissions.type` に `'shield'` を追加、`apply_shield` / `remove_shield` RPC関数を作成
   - `streakCalculator.ts`: `calculateStreak` からシールド自動消費を撤廃し、`shieldDates` セットによる手動適用済みシールドの参照に変更。新関数 `calculatePerfectWeeks` を追加（週単位でリバイバル・シールド許容を個別制御可能）
   - `useGamification.ts`: シールド適用/取り消しコールバック（`applyShield` / `removeShield`）を追加。`confirmedBeforeDate` を `startOfDay(today)` に修正（完了した週のみカウント）。`effective_from` 時のシールド残数を `perfectWeekCount / straight_count - 使用済み` でオンデマンド計算
   - `SwipeableWorkoutView.tsx`: シールド適用/取り消しボタンとシールド適用状態表示を追加
   - `CalendarPage.tsx`: シールド日のカレンダーインジケータ表示、ストレートPopoverに動的条件テキストと確定週の説明を追加
   - `SubmissionSettingsPage.tsx`: ストレート設定UIを刷新（目標日数モード選択、リバイバル/シールド許容チェックボックス）
   - `gamification.types.ts`: `GamificationStraightSettings` を拡張（`use_target_days`, `custom_required_days`, `allow_revival`, `allow_shield`）、未使用の `weekly_target` フィールドを削除

   **変更ファイル**
   - `supabase/migrations/phase_d_gamification_overhaul.sql`（新規）
   - `supabase/schema.sql`
   - `src/types/database.types.ts`
   - `src/types/gamification.types.ts`
   - `src/utils/streakCalculator.ts`
   - `src/hooks/useGamification.ts`
   - `src/pages/calendar/CalendarPage.tsx`
   - `src/components/calendar/SwipeableWorkoutView.tsx`
   - `src/pages/admin/SubmissionSettingsPage.tsx`
   - `src/pages/admin/SubmissionsPage.tsx`

## 2026-02-25

1. グループ達成状況のカレンダーUI表示 (v1.23.0)
   - グループ日（例: 土日グループ）のカレンダーセルにグループラベルと日数進捗を表示（例: 「土日 0/1」橙色、「土日 1/1」緑色）
   - グループ充足日（他の日で達成済み）は投稿日と同じ進捗表示を維持しつつ、スタンプ・インジケータは非表示、投稿カード（PendingUploadCard）も非表示
   - SwipeableWorkoutView にグループ達成メッセージ「グループ達成済み」を追加
   - 曜日ラベルを月曜始まり順でソート（streakCalculator.ts の weekStartsOn:1 と統一）
   - グループ充足判定ユーティリティ `getGroupInfoForDate` / `isGroupFulfilledForDate` を新規作成。effectiveFrom 以前の日を除外、status='fail' の投稿を除外

   **変更ファイル**
   - `src/utils/groupFulfillment.ts`（新規）
   - `src/pages/calendar/CalendarPage.tsx`
   - `src/components/calendar/SwipeableWorkoutView.tsx`

2. effective_from 基盤変更・目標日の設定刷新（休息日・グループ対応）(v1.22.0)
   - `submission_items` と `submission_rules` に `effective_from` 列を追加し、ルール/項目の適用開始日を `created_at` から独立して管理可能に
   - `submission_rules` に `group_id`・`group_required_count` 列を追加し、`rule_type` に `'rest_day'`・`'group'` を追加
   - 既存の `target_day=false` ルールを `rest_day` に自動変換するマイグレーション `phase_c_effective_from_and_goal_day.sql` を作成
   - `useSubmissionRules` のソートを `created_at` → `effective_from` に変更、`isRestDayForDate`（最新 effective_from 優先）・`getAllGroupConfigs`・`getTargetDaysPerWeek` を追加
   - `useSubmissionItems` に `getEffectiveSubmissionItems`（effective_from ベース）・`handleUpdateItemEffectiveFrom` を追加
   - `streakCalculator.ts` に `GroupConfig` 型とグループ対応2フェーズアルゴリズムを実装（フェーズA: 正順で週ごとグループ承認数を事前計算、フェーズB: 逆順でグループスキップ/シールド消費判定）
   - グループ週キーを `weekStartsOn: 1`（月曜始まり）に設定し、土日が同一週に入るよう修正（`weekStartsOn: 0` では土→日で週が分かれるバグを修正）
   - 管理画面「投稿対象日の設定」→「目標日の設定」に刷新: 休息日セクション（曜日チップ選択 + 適用開始日）、グループセクション（曜日選択 + 必須日数 + 適用開始日）を新設
   - `RuleList` コンポーネントを `effective_from` 表示に変更、グループルールは同一 `group_id` をまとめて1行表示、一括 effective_from 更新・一括削除に対応
   - カレンダー画面の休息日判定を `isRestDayForDate` 関数に切り替え、`SwipeableWorkoutView` の `isRestDay` を日付ごとの関数に変更
   - `useGamification` に `groupConfigs` オプションを追加、`calculateCumulativePerfectWeeks` にグループスキップ判定を実装
   - `database.types.ts` に `effective_from`・`group_id`・`group_required_count` の型定義を追加、`rule_type` を拡張

   **変更ファイル**
   - `supabase/migrations/phase_c_effective_from_and_goal_day.sql`（新規）
   - `supabase/schema.sql`
   - `src/types/database.types.ts`
   - `src/hooks/useSubmissionRules.ts`
   - `src/hooks/useSubmissionItems.ts`
   - `src/utils/streakCalculator.ts`
   - `src/pages/admin/SubmissionSettingsPage.tsx`
   - `src/pages/calendar/CalendarPage.tsx`
   - `src/hooks/useGamification.ts`
   - `src/components/calendar/SwipeableWorkoutView.tsx`

## 2026-02-23

1. 期限ロジック整理（deadline_mode 'block' 廃止・is_late / is_revival 判定修正）(v1.21.0)
   - `deadline_mode = 'block'`（投稿ブロック）を廃止し、`'none'` / `'mark'` の 2 値に簡素化
   - `UploadModal` / `PendingUploadCard` から `deadlineMode` Props・`isBlocked` ロジック・ブロック UI を削除
   - 管理画面「提出設定」の「期限の動作設定」から「期限を厳守（ブロック）」ラジオボタンを削除
   - 説明テキストを「当日のみ適用」→「過去日付でも適用」の正確な内容に更新
   - `profiles` テーブルの CHECK 制約を `'block'` 除外の 2 値に変更するマイグレーション `remove_deadline_mode_block.sql` を作成
   - `is_late` 判定を当日限定（`isToday && isDeadlinePassed`）から全日付対応（`isDeadlinePassed` のみ）に変更し、過去日付への投稿でも期限超過が正しく記録されるよう修正
   - リバイバル判定（`is_revival`）を「承認日 < today」から「`created_at > target_date`」に修正し、当日投稿→翌日以降承認の誤リバイバル扱いを解消
   - タイムゾーン安全のため `new Date('YYYY-MM-DD')` による UTC 解釈を廃止し、`new Date(y, m-1, d)` でローカル深夜0時を生成するよう統一

2. R2 ストレージ管理・動画自動クリーンアップ機能の実装 (v1.20.0)
   - 管理者の「提出設定」にストレージ管理カードを追加し、ストレージ上限（GB）・使用量・クライアントごとの動画保持期間（日）を設定可能に
   - `profiles` テーブルに `storage_limit_gb` / `video_retention_days` カラムを追加（マイグレーション `add_video_retention_days.sql`）
   - ストレージ上限超過チェック用 DB トリガー `check_storage_limit` を実装（マイグレーション `add_storage_limit_trigger.sql`）
   - アップロード時に `checkR2StorageAvailable` で先行チェックを行い、上限超過時は早期エラー表示
   - `cleanup-videos` Edge Function を完全書き換え: `@aws-sdk/client-s3` を廃止し `aws4fetch` に移行（Deno 環境で `@smithy/shared-ini-file-loader` が `fs.readFile` を呼ぶ問題を根本解決）
   - Edge Function の処理: ① 保持期間を超えた動画を R2 から削除 → DB の `r2_key` を null 化 ② R2 に存在するが DB にないファイル（孤立オブジェクト）を自動削除（5 分グレースウィンドウつき）
   - 管理者がアプリを開いたタイミングで `cleanup-videos` をバックグラウンド自動実行（`AppLayout.tsx` の `useEffect`）
   - `r2.ts` に `deleteR2Object` / `checkR2StorageAvailable` ヘルパー関数を追加
   - 動画プレイヤーの再生速度選択肢を `[1, 1.5, 2, 2.5, 3]` → `[1, 2, 3, 4, 5]` に変更
   - ストレージ使用量 Popover に計算タイミングの説明文を追加

2. ゲーミフィケーション改善・適用開始機能・DB整理 (v1.19.0)
   - TOTAL表示を累積日数＋累積回数の2値表示に改善し、Popoverで各項目の説明を表示（`total_reps.enabled` で表示制御）
   - 全ゲーミフィケーション項目共通の「適用開始日 (effective_from)」を追加。設定日以降のデータのみを計算対象とする
   - `effective_from` 設定時は totalReps / totalDays / revivalSuccessCount / perfectWeekCount を submissions からオンデマンド計算、シールド残数は 0 リセット
   - `calculateCumulativePerfectWeeks` ヘルパー関数を追加（ストリーク途切れに依存しない全期間ストレート達成カウント）
   - `streakCalculator.ts` に `effectiveFrom` パラメータを追加し、適用開始日より前でストリーク走査を break
   - リバイバル回数表示を workouts 直接計算から `gamification.state.revivalSuccessCount` に変更（effective_from フィルタ反映）
   - 管理画面に累積記録の表示ON/OFFトグルと適用開始日の入力UIを追加
   - `deadlines` テーブル（未使用）と `profiles.streak_count` 列（未使用）を削除
   - 管理者以外のデータクリーンアップ用マイグレーション `gamification_effective_from_cleanup.sql` を作成

2. 論理削除撤廃・created_at 編集可能化によるシンプル化 (v1.18.0)
   - `submission_items` と `submission_rules` から `deleted_at` カラムを完全に削除し、論理削除から物理削除（`.delete()`）に切り替え
   - `created_at` を「適用開始日」として管理画面から編集可能に変更（日付ピッカーUI追加）
   - `database.types.ts` から両テーブルの `deleted_at` 型定義を削除
   - `useSubmissionRules.ts` の `getRuleForDate` を簡素化（deleted_at 判定を除去、`created_at <= endOfTargetDate` のみに）、セカンダリソート（id desc）を追加
   - `CalendarPage.tsx` の進捗カウントロジックを有効項目IDとの積集合方式に書き換え（物理削除による `ON DELETE SET NULL` 対応）
   - `SwipeableWorkoutView.tsx` の `getEffectiveItems` から deleted_at フィルタを除去
   - `SubmissionSettingsPage.tsx` に `handleUpdateItemCreatedAt` / `handleUpdateRuleCreatedAt` ハンドラーを追加、項目カードとルールカードに「適用開始」日付ピッカーを実装
   - `RuleList` コンポーネントのソートを `created_at` desc + ID desc に改善、`onUpdateCreatedAt` プロップを追加
   - `schema.sql` から両テーブルの `deleted_at` 列定義を削除
   - DBマイグレーション `remove_soft_delete.sql` を新規作成（論理削除済みレコード物理削除 → deleted_at 列 DROP）

## 2026-02-22

1. スキーマ完全化・FK列名統一・authorized_users紐付け (v1.17.0)
   - `schema.sql` を全7テーブル＋全RLSポリシーの完全定義に書き換え
   - FK列名を `client_id`/`admin_id` → `user_id` に統一（submission_items, submission_rules, admin_comments）
   - `profiles` テーブルに不足していた9カラム（past_submission_days, future_submission_days, deadline_mode, show_duplicate_to_user 等）を追加
   - 管理者用 UPDATE/DELETE ポリシーを submissions, profiles に追加
   - `authorized_users` に `user_id` カラムを追加し、ログイン時に `profiles` と自動紐付け
   - `database.types.ts` の型定義を統一後の列名に更新
   - `AuthContext.tsx` の Profile リテラルに `show_duplicate_to_user` を追加、authorized_users紐付け処理を追加
   - `delete_user_completely.sql` の列名参照を更新

2. ユーザー完全削除機能の実装 (v1.16.0)
   - 管理者画面からユーザーを完全削除できる機能を実装（従来は `authorized_users` の削除のみ）
   - Supabase RPC関数 `delete_user_completely` を作成し、submissions・admin_comments・submission_items・submission_rules・profiles・authorized_users・auth.users を一括削除
   - R2上の動画ファイルもDB記録のキーとプレフィックス走査の両方で漏れなく削除
   - 削除確認ダイアログを `confirm()` から shadcn/ui `AlertDialog` に置換し、削除対象データの一覧を日本語で表示
   - `r2.ts` に `listR2ObjectsByPrefix` / `deleteR2ObjectsByPrefix` ヘルパー関数を追加

## 2026-02-21

1. Vercel デプロイエラーの修正 (v1.15.1)
   - v1.15.0 で `Profile` 型に追加された `gamification_settings` プロパティが `AuthContext.tsx` に反映されておらず TypeScript ビルドエラーが発生していた問題を修正
   - `AuthContext.tsx` の新規プロフィール作成箇所とエラー時フォールバック箇所の2か所に `gamification_settings: null` を追加

## 2026-02-01
1. 動画重複検知機能の実装 (v1.12.0)
   - アップロード前にブラウザ側で動画ファイルの SHA-256 ハッシュ値を計算する機能を実装
   - `submissions` テーブルに `video_size` と `video_hash` を保存するように拡張
   - 同一ユーザーによる同じ動画（ハッシュ値一致）の投稿を検知し、管理者画面とカレンダー画面で警告を表示
   - R2 アップロード時のホスト名解決エラー（`ERR_NAME_NOT_RESOLVED`）を `forcePathStyle: true` 設定で修正
   - ブラウザ環境でのアップロードエラー（`getReader is not a function`）を `ArrayBuffer` 使用により解消
   - アップロードロジックのメモリ使用量を最適化
   - `UploadModal.tsx` と `PendingUploadCard.tsx` の両方に重複検知・保存ロジックを統合
2. 提出設定の簡略化（投稿対象日の設定） (v1.13.0)
   - 投稿対象日の設定から「月間」スコープを削除
   - デフォルトのスコープを「曜日指定」に変更
   - デフォルトの設定内容を「対象外（休息日）」に変更し、選択肢を先頭に移動
3. 重複表示の管理者設定機能と検知精度の向上 (v1.14.0)
   - 同じ動画時間（Duration）の動画も「重複の可能性」として検知するように改善（リサイズ対策）
   - 「重複の可能性」バッジをタップすると詳細（Hash一致 or Duration一致、重複元の日付・ファイル名）をPopoverで表示
   - 管理者の「提出設定」に「重複の表示」カードを追加し、クライアント側への表示可否を設定可能に
   - `profiles` テーブルに `show_duplicate_to_user` カラムを追加
4. ワークアウトカードのモバイル実機表示修正 (v1.14.1)
   - 縦長動画のサムネイルによりカードが見切れる問題を修正
   - 右側コンテンツ部分を高さの基準にし、サムネイルがそれに追従するレイアウトに変更
   - 「重複の可能性」バッジが常に表示されるように改善
5. ゲーミフィケーション設定機能の実装 (v1.15.0)
   - 管理者の「提出設定」に「ゲーミフィケーション」カードを追加
   - ストレート達成の週N日設定、シールドの獲得条件設定を実装
   - 各ゲーミフィケーション要素（ストレート、シールド、リバイバル、連続日数）の表示/非表示トグルを追加
   - カレンダー画面のゲーミフィケーションダッシュボードを設定に基づき条件分岐表示に対応
   - Tooltipテキストを設定値に基づき動的に生成するよう改善
   - `gamification.types.ts` を新規作成し、ゲーミフィケーション設定の型定義を整備
   - `database.types.ts` と `useGamification.ts` を更新し、設定の保存・取得に対応
## 2026-01-11
1. ゲーミフィケーション機能の実装 (v1.11.0)
   - ストリーク計算（連続投稿日数）のオンデマンド計算ロジックを実装
   - シールド機能（投稿を忘れた日のストリーク保護、7日連続達成で+1獲得）
   - リバイバル機能（過去の空白日を後から埋めてストリーク復活）
   - ストレート達成（7日連続をシールドなしで達成した回数）のカウント
   - 累積回数（TOTAL）の承認時自動更新と取り消し時の減算対応
   - ダッシュボードUI（2段レイアウト、Popoverでの説明表示）
   - カレンダーセルに承認スタンプ（あざす/要修正/フェニックス）のオーバーレイ表示
   - ワークアウトカードに承認回数バッジを追加
   - `submissions`テーブルに`is_revival`、`reps`カラムを追加
   - `profiles`テーブルに`total_reps`、`shield_stock`、`perfect_week_count`、`revival_success_count`カラムを追加
   - クライアント向けリバイバル通知ポップアップ（localStorage経由）

2. ゲーミフィケーションデータの同期・減算バグの修正 (v1.11.1)
   - ワークアウト削除時に `total_reps` と `revival_success_count` が減算されないバグを修正
   - 承認済みの投稿を「却下」または「未承認」に戻した際にもカウントが正しく減算されるように修正
   - `profiles` テーブルのリアルタイム購読を実装し、合計回数などの変更が即座に UI に反映されるように改善

3. 管理者コメント削除機能の実装 (v1.11.2)
   - 管理者コメントの物理削除機能を実装（`admin_comments`テーブル）
   - 管理者向けUIに削除ボタンを追加、確認ダイアログを実装
   - 削除後のカレンダーアイコン消去およびクライアント側へのリアルタイム反映（Supabase Realtime）

## 2026-01-10
1. 管理者コメント機能の実装 (v1.9.0)
   - 管理者がワークアウトカードにフィードバックコメントを投稿できる機能を追加
   - クライアント側でコメントを閲覧し、既読フラグを自動更新する機能を実装
   - カレンダーセルにコメント有りアイコン（吹き出し）を表示
   - 未読コメントがある場合はオレンジの点滅インジケーターを表示
   - `admin_comments` テーブルの作成とRLSポリシーの設定
   - Supabase Realtimeによるコメントの即時反映対応
2. 提出期限の強制機能の実装 (v1.10.0)
   - 期限の動作設定を3モードから選択可能に（目安のみ / マーク / ブロック）
   - 「目安のみ」: 期限超過を記録するがバッジ非表示、投稿可能
   - 「期限超過を許可してマーク」: 期限超過時に「期限超過」バッジを表示、投稿可能
   - 「期限を厳守（ブロック）」: 期限超過時は投稿をブロック
   - 期限チェックは当日の投稿にのみ適用（過去・未来には適用しない）
   - `profiles`テーブルに`deadline_mode`カラム、`submissions`テーブルに`is_late`カラムを追加
   - `useSubmissionRules`フックに`isDeadlinePassed()`関数を追加

## 2026-01-09
1. 承認フロー改善とボタンUI刷新 (v1.7.0)
   - 動画投稿時の自動承認を廃止（管理者が明示的に承認ボタンを押すまで「未承認」状態）
   - 承認・却下ボタンをコンパクトなアイコンボタンに変更し、投稿時刻の下に横一列配置
   - 「戻す」ボタンを追加（承認/却下状態を未承認に戻す機能）
   - 承認・却下判子にレビュー日時のタイムスタンプを表示
   - 判子をカードの右側中央にオーバーレイ表示（ボタンと重ならないよう配置）
   - Supabaseに管理者用UPDATEポリシーを追加
2. カレンダー表示の改善と型定義修正 (v1.7.1)
   - 却下判子表示時の赤インジケーター（冗長）を非表示に変更
   - submissionsテーブルのstatus型に`null`を追加（未承認状態の型安全性向上）
3. カルーセルUI刷新とリアルタイム同期 (v1.8.0)
   - FABとカレンダー内プラスボタンを廃止し、カルーセル内に未投稿カードを統合
   - 未投稿カードに「×」ボタンを追加（ファイル選択キャンセル機能）
   - 管理者カレンダーをClient表示と統一（選択クライアントの投稿制限を使用）
   - Supabase Realtimeによる承認・却下・提出設定のリアルタイム同期
   - 休息日UIの実装（カレンダーに「休」表示、カルーセルに休息日メッセージ）
   - 休息日は投稿許可範囲内でも動画投稿不可に（休息日設定優先）

## 2026-01-07
1. Vercelデプロイ時のビルドエラー修正 (v1.5.2)
   - `AuthContext.tsx`においてProfile型に必須の`past_submission_days`と`future_submission_days`が不足していたのを修正
   - 新規プロファイル作成時にデフォルト値（各7日）を設定
2. サイドバーへのバージョン表示機能追加 (v1.5.3)
   - `package.json`のバージョンをVite経由でビルド時に注入
   - サイドバー下部のTheme左側に`v1.5.3`形式で表示
   - デスクトップ・モバイル両方に対応
3. カレンダーページのUI/UX大幅改善 (v1.6.0)
   - モバイル向け月スワイプナビゲーションの実装
   - 「今日」ボタンおよび月移動時の日付保持ロジックの追加
   - ポップオーバー形式のミニカレンダー日付選択機能の実装
   - ワークアウト表示のスワイプカルーセル化（前後日のチラ見せ・スムーズな遷移アニメーション）
   - デスクトップ環境向けのナビゲーションボタンと操作性の最適化
4. 投稿機能とワークアウトカードの機能強化 (v1.6.1)
   - 動画投稿時にサムネイルが確実に表示されるよう生成ロジックを強化
   - 同一項目（HIIT等）への再投稿時に古いデータを物理削除し「完全な上書き」を実現
   - 提出日時の詳細化（秒単位まで表示）と、モバイルでのレイアウト崩れ防止
   - 省略された提出日時をタップで確認できるポップオーバー（Tooltip）機能の実装
   - 削除ボタンの常時表示化によるモバイル操作性の向上

## 2026-01-06
1. 提出設定の過去履歴保護機能の実装 (v1.4.2)
   - 投稿項目・提出期限・投稿対象日のすべてに論理削除（`deleted_at`）を導入
   - カレンダー表示において、各日付時点で有効だった設定のみを反映するロジックを実装
   - 設定の追加・削除が過去の表示（`2/2`等の完了状態）に影響しないよう改善
   - 未使用の `deadlines` テーブルをデータベースから削除
2. カレンダー投稿日数制限機能の実装 (v1.5.0)
   - 管理者がクライアントごとに「過去の投稿を許可」「未来の投稿を許可」を日数で設定可能に
   - 設定範囲外の日付ではカレンダー上のプラスボタンを非表示にする制御を実装
   - プリセット値（当日のみ / 3日まで / 7日まで / 14日まで / 30日まで / 無制限）を用意
   - `profiles` テーブルへのカラム追加と管理者向けRLSポリシーの追加
3. 過去日投稿時の項目選択改善 (v1.5.1)
   - 過去の日付に投稿する際、現在存在する項目を選択可能に変更
   - カレンダー表示の進捗（0/2等）は履歴ベースのまま維持

## 2026-01-05
6. 提出設定の階層化とUIの洗練 (v1.3.0)
   - 提出期限と投稿対象日の階層的なオーバーライドシステム（月間 > 曜日 > 日別）の実装
   - 管理画面における提出設定のUI刷新（カード分離、曜日の一括選択、選択状態の視認性向上）
   - カレンダーUIのレイアウト最適化（要素配置の調整、セルの高さ拡張）
   - 休息日（投稿対象外）における期限テキストの非表示化
   - モバイル環境におけるボタンの「粘着」ホバー状態の解消
   - バックエンド連携 (`submission_rules` テーブル) の実装と履歴保存対応
7. モバイルUXの改善とUIの統一 (v1.3.1)
   - 管理者「Users」画面のモバイル対応（カード型レイアウトの実装）
   - カレンダー上の動画に対する削除/再生ボタンのモバイル最適化（常時表示によるアフォーダンス向上）
   - 提出設定画面（期限設定・対象日設定）のデザイン統一とPrimaryカラーへの変更
   - 削除・編集アクションのアクセシビリティ改善（ホバー依存からの脱却）
1. 管理者用カレンダー機能の拡張と動画再生の実装 (v1.1.0)
   - 管理者によるクライアント選択機能の実装（クライアント名のアルファベット順ソート）
   - 管理者の前回選択したクライアントを localStorage に保存・復元する機能の実装
   - カレンダー内での動画再生機能（VideoPlayerModal）の統合
   - `useSubmissions` フックを `useWorkoutHistory` へ統合・リファクタリング
   - 管理者用のアクションボタン（承認・却下・コメント）のプレースホルダ設置
2. カレンダー表示不具合の解消と独自実装への移行 (v0.7.0)
   - Docker/PWA環境におけるFullCalendarのCSS表示問題を特定
   - FullCalendarを廃止し、shadcn/ui (react-day-picker) ベースの独自カレンダーを実装
   - 日付ごとの枠線（グリッド）表示、ステータスインジケーター（3色ドット）の実装
   - 未アップロード日に対するクイック追加ボタン（＋）の実装
   - 不要な依存関係（@fullcalendar/*）の削除とコードのクリーンアップ
2. 動画削除機能の実装 (v0.8.0)
   - Cloudflare R2 と Supabase の両方からデータを削除する機能を実装
   - ユーザー用カレンダーおよび管理者ページへの削除ボタンの設置
   - 削除時の確認ダイアログとローディング表示の実装
   - Supabaseの RLS (Row Level Security) 削除ポリシーの追加
   - 削除後のUI自動更新（サイレント・リフレッシュ）の改善
3. ユーザー管理機能 (Phase 11) 実装 (v0.9.0)
   - `authorized_users` テーブルによるホワイトリスト形式のログイン制限
   - 管理者専用のユーザー管理ページ (`/admin/users`) の作成
   - Google ログイン時のメタデータ（フルネーム）取得とプロファイル名の自動更新同期
   - 下部サイドバーへのログインユーザー情報の表示改善
4. サイドバーの改善とレイアウトの最適化 (v1.0.0)
   - 不要なページ（Dashboard, Upload, Profile）の削除とルート設定の更新
   - サイドバーへのロゴ追加とロール別メニュー（Admin/Client）の実装
   - デスクトップ版折りたたみ式サイドバーの実装と位置調整
   - モバイル版メニューアイコンの変更とロゴ追加
5. カレンダーのUI/UX改善 (v1.2.0)
   - 日付表示形式を `2025/12/30(火)` 形式に変更し、視認性を向上
   - モバイル表示時において、カレンダーの横幅を最大限まで広げるようレイアウトを調整

## 2026-01-04
1. プロジェクト初期化とDocker環境構築 (v0.1.0)
   - Vite + React + TypeScript + Tailwind プロジェクト作成
   - Docker環境構築 (node:24-slim, port:5175)
   - 依存パッケージのインストールと競合解決 (date-fns)
2. データベース & バックエンド設定
   - Supabaseスキーマ定義 (profiles, deadlines, submissions)
   - クライアント接続設定とTypeScript型定義作成
3. UI基礎 & レイアウト実装
   - shadcn/uiコンポーネント(Button, Sheet, DropdownMenu等)導入
   - テーマ切替(Dark/Light)機能
   - レスポンシブサイドバーレイアウト (AppLayout)
4. 認証機能 (Google OAuth) 実装
   - AuthContext による認証状態管理
   - Google認証 (signInWithOAuth) の実装
   - ログイン画面 (LoginPage) とルート保護 (RequireAuth) 実装
   - ログアウト機能実装

5. カレンダー & 期限管理機能 (Phase 5) 実装 (v0.2.0)
   - FullCalendar によるワークアウトカレンダーの統合
   - 管理者用期限管理画面 (Deadline Management) の作成
   - プロフィール情報 (Profiles) の取得とロールベースのアクセス制御
   - 特定メールアドレス (estacercadeaqui@gmail.com) への管理者権限付与ロジックの実装
   - Docker環境での依存関係競合解決とビルド安定化
6. 動画アップロード機能 (Phase 6) 実装 (v0.3.0)
   - Cloudflare R2 バケット作成とAPIトークン設定
   - VideoUploaderコンポーネント実装（ファイル選択、バリデーション、進捗表示）
   - サムネイル自動生成機能（Canvas API）
   - Supabase submissions テーブルへのメタデータ保存
   - 初回ログイン時のプロファイル自動作成機能
7. 管理者ダッシュボード (Phase 7) 実装 (v0.4.0)
   - 全ユーザーの提出一覧表示 (SubmissionsPage)
   - サムネイルプレビュー付きカード表示
   - 動画プレイヤー (1x - 3x 再生速度コントロール)
   - デスクトップ・モバイル両対応のサイドバー更新
8. カレンダー連携とアップロード改善 (Phase 8-1) 実装 (v0.5.0)
   - カレンダーの日付クリックからのアップロード連携
   - 提出データへの対象日付 (target_date) カラムの追加
   - アップロード完了後のカレンダー自動更新機能
9. PWA化対応 (Phase 8-2) 実装 (v0.6.0)
   - vite-plugin-pwaの導入とマニフェスト設定
   - ユーザー提供アイコンの配置とアセット設定
   - モバイル向けメタタグの最適化
10. Vercelデプロイと本番環境確認 (Phase 9) 完了 (v0.6.0)
   - Vercelへのデプロイ成功と環境変数の設定
   - Supabaseの認証リダイレクトURLの更新
   - Android実機(PWA)でのログイン・動作確認成功
11. メンテナンス用Edge Function (Phase 10) スケルトン作成 (v0.6.0)
   - 120日（約4ヶ月）経過した動画をR2から自動削除するロジックの実装
   - データの整合性を保ちつつストレージを節約する構成

8. 複数動画投稿機能の実装とカレンダーUIの刷新 (v1.4.0)
   - 管理画面に投稿項目の設定機能を追加（項目ごとのタスク管理が可能に）
   - カレンダー上の進捗表示機能（"1/2"）と複数投稿時の項目選択モーダルの実装
   - カレンダーセルのUIレイアウト最適化（アクションボタン表示時のインジケーター自動制御による冗長性排除）
   - 動画リストカードの横長レイアウト化と詳細日時表示への変更
   - データベーススキーマ更新 (`submission_items` テーブル追加)
9. ビルドエラーの修正とデプロイ安定化 (v1.4.1)
   - Vercelデプロイ時に発生していたTypeScriptビルドエラーの解消
   - AuthContextおよびSubmissionSettingsPageにおける型定義の厳格化とキャスト修正
   - プロダクションビルド (`npm run build`) の正常終了を確認
