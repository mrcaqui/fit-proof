# 進捗記録
## 2026-02-01
1. 動画重複検知機能の実装 (v1.12.0)
   - アップロード前にブラウザ側で動画ファイルの SHA-256 ハッシュ値を計算する機能を実装
   - `submissions` テーブルに `video_size` と `video_hash` を保存するように拡張
   - 同一ユーザーによる同じ動画（ハッシュ値一致）の投稿を検知し、管理者画面とカレンダー画面で警告を表示
   - R2 アップロード時のホスト名解決エラー（`ERR_NAME_NOT_RESOLVED`）を `forcePathStyle: true` 設定で修正
   - ブラウザ環境でのアップロードエラー（`getReader is not a function`）を `ArrayBuffer` 使用により解消
   - アップロードロジックのメモリ使用量を最適化
   - `UploadModal.tsx` と `PendingUploadCard.tsx` の両方に重複検知・保存ロジックを統合
2. 提出設定の簡略化（投稿対象日の設定） (v1.13.0)
   - 投稿対象日の設定から「月間」スコープを削除
   - デフォルトのスコープを「曜日指定」に変更
   - デフォルトの設定内容を「対象外（休息日）」に変更し、選択肢を先頭に移動

## 2026-01-11
1. ゲーミフィケーション機能の実装 (v1.11.0)
   - ストリーク計算（連続投稿日数）のオンデマンド計算ロジックを実装
   - シールド機能（投稿を忘れた日のストリーク保護、7日連続達成で+1獲得）
   - リバイバル機能（過去の空白日を後から埋めてストリーク復活）
   - ストレート達成（7日連続をシールドなしで達成した回数）のカウント
   - 累積回数（TOTAL）の承認時自動更新と取り消し時の減算対応
   - ダッシュボードUI（2段レイアウト、Popoverでの説明表示）
   - カレンダーセルに承認スタンプ（あざす/要修正/フェニックス）のオーバーレイ表示
   - ワークアウトカードに承認回数バッジを追加
   - `submissions`テーブルに`is_revival`、`reps`カラムを追加
   - `profiles`テーブルに`total_reps`、`shield_stock`、`perfect_week_count`、`revival_success_count`カラムを追加
   - クライアント向けリバイバル通知ポップアップ（localStorage経由）

2. ゲーミフィケーションデータの同期・減算バグの修正 (v1.11.1)
   - ワークアウト削除時に `total_reps` と `revival_success_count` が減算されないバグを修正
   - 承認済みの投稿を「却下」または「未承認」に戻した際にもカウントが正しく減算されるように修正
   - `profiles` テーブルのリアルタイム購読を実装し、合計回数などの変更が即座に UI に反映されるように改善

3. 管理者コメント削除機能の実装 (v1.11.2)
   - 管理者コメントの物理削除機能を実装（`admin_comments`テーブル）
   - 管理者向けUIに削除ボタンを追加、確認ダイアログを実装
   - 削除後のカレンダーアイコン消去およびクライアント側へのリアルタイム反映（Supabase Realtime）

## 2026-01-10
1. 管理者コメント機能の実装 (v1.9.0)
   - 管理者がワークアウトカードにフィードバックコメントを投稿できる機能を追加
   - クライアント側でコメントを閲覧し、既読フラグを自動更新する機能を実装
   - カレンダーセルにコメント有りアイコン（吹き出し）を表示
   - 未読コメントがある場合はオレンジの点滅インジケーターを表示
   - `admin_comments` テーブルの作成とRLSポリシーの設定
   - Supabase Realtimeによるコメントの即時反映対応
2. 提出期限の強制機能の実装 (v1.10.0)
   - 期限の動作設定を3モードから選択可能に（目安のみ / マーク / ブロック）
   - 「目安のみ」: 期限超過を記録するがバッジ非表示、投稿可能
   - 「期限超過を許可してマーク」: 期限超過時に「期限超過」バッジを表示、投稿可能
   - 「期限を厳守（ブロック）」: 期限超過時は投稿をブロック
   - 期限チェックは当日の投稿にのみ適用（過去・未来には適用しない）
   - `profiles`テーブルに`deadline_mode`カラム、`submissions`テーブルに`is_late`カラムを追加
   - `useSubmissionRules`フックに`isDeadlinePassed()`関数を追加

## 2026-01-09
1. 承認フロー改善とボタンUI刷新 (v1.7.0)
   - 動画投稿時の自動承認を廃止（管理者が明示的に承認ボタンを押すまで「未承認」状態）
   - 承認・却下ボタンをコンパクトなアイコンボタンに変更し、投稿時刻の下に横一列配置
   - 「戻す」ボタンを追加（承認/却下状態を未承認に戻す機能）
   - 承認・却下判子にレビュー日時のタイムスタンプを表示
   - 判子をカードの右側中央にオーバーレイ表示（ボタンと重ならないよう配置）
   - Supabaseに管理者用UPDATEポリシーを追加
2. カレンダー表示の改善と型定義修正 (v1.7.1)
   - 却下判子表示時の赤インジケーター（冗長）を非表示に変更
   - submissionsテーブルのstatus型に`null`を追加（未承認状態の型安全性向上）
3. カルーセルUI刷新とリアルタイム同期 (v1.8.0)
   - FABとカレンダー内プラスボタンを廃止し、カルーセル内に未投稿カードを統合
   - 未投稿カードに「×」ボタンを追加（ファイル選択キャンセル機能）
   - 管理者カレンダーをClient表示と統一（選択クライアントの投稿制限を使用）
   - Supabase Realtimeによる承認・却下・提出設定のリアルタイム同期
   - 休息日UIの実装（カレンダーに「休」表示、カルーセルに休息日メッセージ）
   - 休息日は投稿許可範囲内でも動画投稿不可に（休息日設定優先）

## 2026-01-07
1. Vercelデプロイ時のビルドエラー修正 (v1.5.2)
   - `AuthContext.tsx`においてProfile型に必須の`past_submission_days`と`future_submission_days`が不足していたのを修正
   - 新規プロファイル作成時にデフォルト値（各7日）を設定
2. サイドバーへのバージョン表示機能追加 (v1.5.3)
   - `package.json`のバージョンをVite経由でビルド時に注入
   - サイドバー下部のTheme左側に`v1.5.3`形式で表示
   - デスクトップ・モバイル両方に対応
3. カレンダーページのUI/UX大幅改善 (v1.6.0)
   - モバイル向け月スワイプナビゲーションの実装
   - 「今日」ボタンおよび月移動時の日付保持ロジックの追加
   - ポップオーバー形式のミニカレンダー日付選択機能の実装
   - ワークアウト表示のスワイプカルーセル化（前後日のチラ見せ・スムーズな遷移アニメーション）
   - デスクトップ環境向けのナビゲーションボタンと操作性の最適化
4. 投稿機能とワークアウトカードの機能強化 (v1.6.1)
   - 動画投稿時にサムネイルが確実に表示されるよう生成ロジックを強化
   - 同一項目（HIIT等）への再投稿時に古いデータを物理削除し「完全な上書き」を実現
   - 提出日時の詳細化（秒単位まで表示）と、モバイルでのレイアウト崩れ防止
   - 省略された提出日時をタップで確認できるポップオーバー（Tooltip）機能の実装
   - 削除ボタンの常時表示化によるモバイル操作性の向上

## 2026-01-06
1. 提出設定の過去履歴保護機能の実装 (v1.4.2)
   - 投稿項目・提出期限・投稿対象日のすべてに論理削除（`deleted_at`）を導入
   - カレンダー表示において、各日付時点で有効だった設定のみを反映するロジックを実装
   - 設定の追加・削除が過去の表示（`2/2`等の完了状態）に影響しないよう改善
   - 未使用の `deadlines` テーブルをデータベースから削除
2. カレンダー投稿日数制限機能の実装 (v1.5.0)
   - 管理者がクライアントごとに「過去の投稿を許可」「未来の投稿を許可」を日数で設定可能に
   - 設定範囲外の日付ではカレンダー上のプラスボタンを非表示にする制御を実装
   - プリセット値（当日のみ / 3日まで / 7日まで / 14日まで / 30日まで / 無制限）を用意
   - `profiles` テーブルへのカラム追加と管理者向けRLSポリシーの追加
3. 過去日投稿時の項目選択改善 (v1.5.1)
   - 過去の日付に投稿する際、現在存在する項目を選択可能に変更
   - カレンダー表示の進捗（0/2等）は履歴ベースのまま維持

## 2026-01-05
6. 提出設定の階層化とUIの洗練 (v1.3.0)
   - 提出期限と投稿対象日の階層的なオーバーライドシステム（月間 > 曜日 > 日別）の実装
   - 管理画面における提出設定のUI刷新（カード分離、曜日の一括選択、選択状態の視認性向上）
   - カレンダーUIのレイアウト最適化（要素配置の調整、セルの高さ拡張）
   - 休息日（投稿対象外）における期限テキストの非表示化
   - モバイル環境におけるボタンの「粘着」ホバー状態の解消
   - バックエンド連携 (`submission_rules` テーブル) の実装と履歴保存対応
7. モバイルUXの改善とUIの統一 (v1.3.1)
   - 管理者「Users」画面のモバイル対応（カード型レイアウトの実装）
   - カレンダー上の動画に対する削除/再生ボタンのモバイル最適化（常時表示によるアフォーダンス向上）
   - 提出設定画面（期限設定・対象日設定）のデザイン統一とPrimaryカラーへの変更
   - 削除・編集アクションのアクセシビリティ改善（ホバー依存からの脱却）
1. 管理者用カレンダー機能の拡張と動画再生の実装 (v1.1.0)
   - 管理者によるクライアント選択機能の実装（クライアント名のアルファベット順ソート）
   - 管理者の前回選択したクライアントを localStorage に保存・復元する機能の実装
   - カレンダー内での動画再生機能（VideoPlayerModal）の統合
   - `useSubmissions` フックを `useWorkoutHistory` へ統合・リファクタリング
   - 管理者用のアクションボタン（承認・却下・コメント）のプレースホルダ設置
2. カレンダー表示不具合の解消と独自実装への移行 (v0.7.0)
   - Docker/PWA環境におけるFullCalendarのCSS表示問題を特定
   - FullCalendarを廃止し、shadcn/ui (react-day-picker) ベースの独自カレンダーを実装
   - 日付ごとの枠線（グリッド）表示、ステータスインジケーター（3色ドット）の実装
   - 未アップロード日に対するクイック追加ボタン（＋）の実装
   - 不要な依存関係（@fullcalendar/*）の削除とコードのクリーンアップ
2. 動画削除機能の実装 (v0.8.0)
   - Cloudflare R2 と Supabase の両方からデータを削除する機能を実装
   - ユーザー用カレンダーおよび管理者ページへの削除ボタンの設置
   - 削除時の確認ダイアログとローディング表示の実装
   - Supabaseの RLS (Row Level Security) 削除ポリシーの追加
   - 削除後のUI自動更新（サイレント・リフレッシュ）の改善
3. ユーザー管理機能 (Phase 11) 実装 (v0.9.0)
   - `authorized_users` テーブルによるホワイトリスト形式のログイン制限
   - 管理者専用のユーザー管理ページ (`/admin/users`) の作成
   - Google ログイン時のメタデータ（フルネーム）取得とプロファイル名の自動更新同期
   - 下部サイドバーへのログインユーザー情報の表示改善
4. サイドバーの改善とレイアウトの最適化 (v1.0.0)
   - 不要なページ（Dashboard, Upload, Profile）の削除とルート設定の更新
   - サイドバーへのロゴ追加とロール別メニュー（Admin/Client）の実装
   - デスクトップ版折りたたみ式サイドバーの実装と位置調整
   - モバイル版メニューアイコンの変更とロゴ追加
5. カレンダーのUI/UX改善 (v1.2.0)
   - 日付表示形式を `2025/12/30(火)` 形式に変更し、視認性を向上
   - モバイル表示時において、カレンダーの横幅を最大限まで広げるようレイアウトを調整

## 2026-01-04
1. プロジェクト初期化とDocker環境構築 (v0.1.0)
   - Vite + React + TypeScript + Tailwind プロジェクト作成
   - Docker環境構築 (node:24-slim, port:5175)
   - 依存パッケージのインストールと競合解決 (date-fns)
2. データベース & バックエンド設定
   - Supabaseスキーマ定義 (profiles, deadlines, submissions)
   - クライアント接続設定とTypeScript型定義作成
3. UI基礎 & レイアウト実装
   - shadcn/uiコンポーネント(Button, Sheet, DropdownMenu等)導入
   - テーマ切替(Dark/Light)機能
   - レスポンシブサイドバーレイアウト (AppLayout)
4. 認証機能 (Google OAuth) 実装
   - AuthContext による認証状態管理
   - Google認証 (signInWithOAuth) の実装
   - ログイン画面 (LoginPage) とルート保護 (RequireAuth) 実装
   - ログアウト機能実装

5. カレンダー & 期限管理機能 (Phase 5) 実装 (v0.2.0)
   - FullCalendar によるワークアウトカレンダーの統合
   - 管理者用期限管理画面 (Deadline Management) の作成
   - プロフィール情報 (Profiles) の取得とロールベースのアクセス制御
   - 特定メールアドレス (estacercadeaqui@gmail.com) への管理者権限付与ロジックの実装
   - Docker環境での依存関係競合解決とビルド安定化
6. 動画アップロード機能 (Phase 6) 実装 (v0.3.0)
   - Cloudflare R2 バケット作成とAPIトークン設定
   - VideoUploaderコンポーネント実装（ファイル選択、バリデーション、進捗表示）
   - サムネイル自動生成機能（Canvas API）
   - Supabase submissions テーブルへのメタデータ保存
   - 初回ログイン時のプロファイル自動作成機能
7. 管理者ダッシュボード (Phase 7) 実装 (v0.4.0)
   - 全ユーザーの提出一覧表示 (SubmissionsPage)
   - サムネイルプレビュー付きカード表示
   - 動画プレイヤー (1x - 3x 再生速度コントロール)
   - デスクトップ・モバイル両対応のサイドバー更新
8. カレンダー連携とアップロード改善 (Phase 8-1) 実装 (v0.5.0)
   - カレンダーの日付クリックからのアップロード連携
   - 提出データへの対象日付 (target_date) カラムの追加
   - アップロード完了後のカレンダー自動更新機能
9. PWA化対応 (Phase 8-2) 実装 (v0.6.0)
   - vite-plugin-pwaの導入とマニフェスト設定
   - ユーザー提供アイコンの配置とアセット設定
   - モバイル向けメタタグの最適化
10. Vercelデプロイと本番環境確認 (Phase 9) 完了 (v0.6.0)
   - Vercelへのデプロイ成功と環境変数の設定
   - Supabaseの認証リダイレクトURLの更新
   - Android実機(PWA)でのログイン・動作確認成功
11. メンテナンス用Edge Function (Phase 10) スケルトン作成 (v0.6.0)
   - 120日（約4ヶ月）経過した動画をR2から自動削除するロジックの実装
   - データの整合性を保ちつつストレージを節約する構成

8. 複数動画投稿機能の実装とカレンダーUIの刷新 (v1.4.0)
   - 管理画面に投稿項目の設定機能を追加（項目ごとのタスク管理が可能に）
   - カレンダー上の進捗表示機能（"1/2"）と複数投稿時の項目選択モーダルの実装
   - カレンダーセルのUIレイアウト最適化（アクションボタン表示時のインジケーター自動制御による冗長性排除）
   - 動画リストカードの横長レイアウト化と詳細日時表示への変更
   - データベーススキーマ更新 (`submission_items` テーブル追加)
9. ビルドエラーの修正とデプロイ安定化 (v1.4.1)
   - Vercelデプロイ時に発生していたTypeScriptビルドエラーの解消
   - AuthContextおよびSubmissionSettingsPageにおける型定義の厳格化とキャスト修正
   - プロダクションビルド (`npm run build`) の正常終了を確認
