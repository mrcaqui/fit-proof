## 1. プロジェクト概要

Vite + Supabase環境のパーソナルトレーナー向けアプリに、初心者の継続を支えるゲーミフィケーション機能を実装します。
**「データが必要な時に履歴から算出する（オンデマンド計算）」**方式を採用し、サーバーサイドの常駐処理なしで、正確なストリークと実績を管理します。

## 2. データベーススキーマの更新

以下のカラムを追加または拡張してください。

* **`workouts` テーブル:** * `reps` (int4): 実施回数。
* `is_revival` (boolean): 過去分投稿による復活記録かどうかのフラグ。


* **`profiles` テーブル:**
* `total_reps` (int4): 累計実施回数。
* `shield_stock` (int4, max 3): 所持シールド数。
* `perfect_week_count` (int4): シールド/リベンジ不使用での7日連続達成（ストレート達成）回数。
* `revival_success_count` (int4): リバイバル成功の累計回数。



## 3. 使用画像アセット（/public/assets/）

UIの各所で以下の画像を適用してください。

1. **`shield.png`**: ダッシュボードのシールド残数表示、カレンダーの「シールド消費日」用。
2. **`phoenix.png`**: カレンダー日付セル内の「リバイバル成功日」のインジケーター用。
3. **`revival_badge.png`**: リバイバル成功時のポップアップ、ダッシュボードの「不屈の復活」実績用。
4. **`perfect_crown.png`**: ダッシュボードの「ストレート達成」実績用。

## 4. ロジックの実装（フロントエンド・ユーティリティ）

### A. オンデマンド・ストリーク計算

画面表示時に `workouts` の承認済み履歴と「定休日設定」から以下を算出します。

* **シールド消費判定:** 未投稿日（定休日除く）に対し `shield_stock` を自動消費。不足時はストリークを0リセット。
* **ストレート達成判定:** 「シールド不使用」かつ「`is_revival` 不使用」で7日間連続投稿された区間をカウントし、`perfect_week_count` を更新。同時に `shield_stock` を +1（上限3）。
* **復活（リバウンド）判定:** 空白を埋める過去投稿が承認された場合、ストリークを過去から現在まで連結。当該レコードの `is_revival` を true にし、`revival_success_count` を更新。

### B. トレーナー側：承認アクション

* 承認モーダルに `reps`（回数）入力欄を追加。
* 承認時、`workouts.reps` を保存し、`profiles.total_reps` を更新する。

## 5. UI/UX 表示仕様

### ① クライアント・ダッシュボード

* **累積:** `TOTAL: {total_reps} 回`（最優先表示）
* **継続:** `{current_streak} 日連続 🔥`
* **守備:** `shield.png` ＋ 残数 `{shield_stock}`
* **王道:** `perfect_crown.png` ＋ `{perfect_week_count} 回（ストレート達成）`
* **不屈:** `revival_badge.png` ＋ `{revival_success_count} 回（不屈の復活）`

### ② カレンダー（DayCell）

* **通常承認:** 緑ドット。
* **シールド消費日:** `shield.png` をセル内に小さく表示。
* **リバイバル日:** `is_revival === true` の日に `phoenix.png` を表示。

### ③ ポップアップ演出（Framer Motion推奨）

* **シールド通知:** アプリ起動時にシールドが消費されていたら `shield.png` を伴うメッセージを表示。
* **復活成功:** リバウンド成功時に `revival_badge.png` が回転・拡大して出現するポップアップを表示。

## 6. 指針

* ユーザー1名の小規模環境を前提に、複雑なサーバーサイドジョブを避け、フロントエンドでの履歴走査とSupabaseのシンプルなUpdate文で完結させてください。
* 各実績（👑、✨）が増える際は、視覚的なフィードバックを強調してください。
